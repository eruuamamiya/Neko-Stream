<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result Genre - NekoStream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
    <link rel="stylesheet" href="style.css"> 
    <style>
        const currentLocation = location.href;
        const menuItem = document.querySelectorAll('.nav-link');
        const menuLength = menuItem.length;
        for (let i = 0; i < menuLength; i++) {
            if (menuItem[i].href === currentLocation) {
                menuItem[i].className += " active";
            }
                }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col pb-20">

<header class="bg-[#161b22] border-b border-[#30363d] sticky top-0 z-50 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            
            <a href="index.html" class="text-2xl font-bold text-white tracking-wider flex items-center gap-2 hover:text-blue-400 transition-colors">
                <span class="text-blue-500 text-3xl"></span> NekoStream
            </a>

            <nav class="flex flex-wrap justify-center gap-6">
                <a href="index.html" class="nav-link" id="nav-home">Home</a>
                <a href="ongoing.html" class="nav-link" id="nav-ongoing">On Going</a>
                <a href="jadwal.html" class="nav-link" id="nav-jadwal">Jadwal Rilis</a>
                <a href="list-anime.html" class="nav-link" id="nav-list">List Anime</a>
                <a href="genre.html" class="nav-link" id="nav-genre">List Genre</a>
            </nav>

        </div>
    </header>

    <main class="container mx-auto p-2 md:p-4 max-w-5xl">
        
        <div class="flex items-center justify-between mb-6 border-b border-[#30363d] pb-4">
            <h1 class="text-xl font-bold text-white flex items-center gap-2">
                <span class="text-blue-500">üìÇ</span> 
                Genre: <span id="genre-title" class="capitalize">...</span>
            </h1>
            <span class="text-xs text-gray-400 bg-[#161b22] px-3 py-1 rounded border border-[#30363d]" id="page-indicator">Page 1</span>
        </div>

        <div id="loading" class="text-center py-20">
            <div class="inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
            <p class="text-gray-500 text-xs">Memuat data genre...</p>
        </div>

        <div id="debug-area" class="hidden col-span-full bg-black border border-red-500 p-4 rounded mb-6 text-left">
            <p class="text-red-400 text-xs font-bold mb-1">Status Error:</p>
            <code id="debug-msg" class="block text-gray-300 text-xs mb-2">...</code>
        </div>

        <div id="anime-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 hidden"></div>

        <div id="pagination" class="hidden flex justify-center items-center gap-4 mt-8 pt-6 border-t border-[#30363d]">
            <button id="btn-prev" class="px-4 py-2 bg-[#21262d] border border-[#30363d] rounded text-xs font-bold text-gray-400 hover:text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition uppercase">‚Üê Prev</button>
            <span class="text-xs font-bold text-white">Page <span id="current-page-num">1</span> / <span id="total-page-num">?</span></span>
            <button id="btn-next" class="px-4 py-2 bg-[#21262d] border border-[#30363d] rounded text-xs font-bold text-gray-400 hover:text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition uppercase">Next ‚Üí</button>
        </div>

    </main>

    <script>
        // UPDATE BASE URL SESUAI PERMINTAAN
        if (typeof API_BASE_URL === 'undefined') { var API_BASE_URL = "https://style-demonstrated-nutten-mark.trycloudflare.com"; }
        
        const urlParams = new URLSearchParams(window.location.search);
        const genreId = urlParams.get('id'); // Ambil ?id=... dari URL Browser
        let currentPage = 1;

        document.addEventListener("DOMContentLoaded", () => {
            // Cek apakah ada ID genre di URL Browser
            if (!genreId) {
                // Tampilkan pesan error jika dibuka tanpa ?id=...
                const loading = document.getElementById('loading');
                const debugArea = document.getElementById('debug-area');
                loading.classList.add('hidden');
                debugArea.classList.remove('hidden');
                document.getElementById('debug-msg').innerText = "URL Salah. Buka halaman ini dari menu 'List Genre' atau tambahkan ?id=nama-genre di akhir link.";
                return;
            }

            document.getElementById('genre-title').innerText = genreId.replace(/-/g, ' ');
            fetchGenreData(1);
            
            // Tombol Pagination
            document.getElementById('btn-prev').addEventListener('click', () => {
                if(currentPage > 1) fetchGenreData(currentPage - 1);
            });
            document.getElementById('btn-next').addEventListener('click', () => {
                fetchGenreData(currentPage + 1);
            });
        });

        async function fetchGenreData(page) {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('anime-grid');
            const paginationDiv = document.getElementById('pagination');
            const debugArea = document.getElementById('debug-area');

            loading.classList.remove('hidden');
            grid.classList.add('hidden');
            paginationDiv.classList.add('hidden');
            debugArea.classList.add('hidden');
            window.scrollTo(0,0);

            try {
                // --- PEMBUATAN URL API (FINAL FIX) ---
                // Format: API_BASE + /otakudesu/genre/ + genreId + ?page= + page
                // Hasil: .../otakudesu/genre/isekai?page=1
                
                const endpoint = `${API_BASE_URL}/otakudesu/genre/${genreId}?page=${page}`;
                
                // console.log("Fetching:", endpoint); // Cek Console untuk debug

                const req = await fetch(endpoint);
                if(!req.ok) throw new Error(`Gagal Fetch: ${req.status} ${req.statusText}`);
                
                const res = await req.json();
                
                // Ambil Data
                const animeList = res.data?.animeList || [];
                // Cek pagination di root, kalau gak ada cek di dalam data (fallback)
                const meta = res.pagination || res.data?.pagination || {}; 

                if(animeList.length === 0) {
                    grid.innerHTML = '<p class="col-span-full text-center text-gray-500 text-xs">Tidak ada anime ditemukan.</p>';
                    grid.classList.remove('hidden');
                    loading.classList.add('hidden');
                    return;
                }

                renderCards(animeList);
                updatePagination(meta, page);

                loading.classList.add('hidden');
                grid.classList.remove('hidden');
                paginationDiv.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                loading.classList.add('hidden');
                debugArea.classList.remove('hidden');
                document.getElementById('debug-msg').innerText = `Error: ${err.message}`;
            }
        }

        function renderCards(list) {
            const grid = document.getElementById('anime-grid');
            let html = '';

            list.forEach(anime => {
                const id = anime.animeId;
                const poster = anime.poster || 'https://via.placeholder.com/150';
                const score = (anime.score && anime.score.trim() !== "") ? anime.score : '?';
                const eps = anime.episodes || '?';
                const season = anime.season || '';
                const studio = anime.studios || '';

                html += `
                <a href="detail.html?id=${id}" class="relative aspect-[3/4] overflow-hidden bg-gray-800 group shadow-lg rounded-md border border-[#30363d] hover:border-blue-500 transition-colors">
                    <img src="${poster}" alt="${anime.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
                    <div class="absolute top-0 left-0 bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded-br-sm shadow-md">‚òÖ ${score}</div>
                    <div class="absolute top-0 right-0 bg-black/60 backdrop-blur-sm text-gray-300 text-[10px] font-bold px-2 py-1 rounded-bl-sm border-l border-b border-white/10">${eps} Eps</div>
                    <div class="absolute bottom-0 w-full bg-black/70 backdrop-blur-[2px] p-2 border-t border-white/5">
                        <h3 class="text-white text-[11px] font-medium leading-tight line-clamp-2 text-center card-font group-hover:text-blue-400 transition-colors">${anime.title}</h3>
                        <div class="flex justify-between items-center mt-1 px-1">
                            <span class="text-[9px] text-gray-400 truncate max-w-[60px]">${studio}</span>
                            <span class="text-[9px] text-gray-400">${season}</span>
                        </div>
                    </div>
                </a>`;
            });
            grid.innerHTML = html;
        }

        function updatePagination(meta, page) {
            currentPage = page;
            document.getElementById('current-page-num').innerText = currentPage;
            const total = meta.totalPages || '?';
            document.getElementById('total-page-num').innerText = total;
            document.getElementById('page-indicator').innerText = `Page ${currentPage} / ${total}`;

            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');

            if (meta.hasPrevPage !== undefined) {
                btnPrev.disabled = !meta.hasPrevPage;
                btnNext.disabled = !meta.hasNextPage;
            } else {
                btnPrev.disabled = (currentPage === 1);
                btnNext.disabled = false;
            }
        }
    </script>
</body>
</html>


