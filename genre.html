<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Genre - NekoStream</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="config.js"></script>

    <style>
        body { background-color: #0d1117; color: #c9d1d9; }
        
        /* Efek Hover Card */
        .genre-card { transition: all 0.2s ease; }
        .genre-card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col">

    <header class="bg-[#161b22] border-b border-[#30363d] sticky top-0 z-50 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <nav class="flex flex-wrap justify-center gap-6">
                <a href="index.html" class="nav-link text-[#e5e7eb] text-sm font-semibold hover:text-blue-400 transition" id="nav-home">Home</a>
                <a href="ongoing.html" class="nav-link text-[#e5e7eb] text-sm font-semibold hover:text-blue-400 transition" id="nav-ongoing">On Going</a>
                <a href="jadwal.html" class="nav-link text-[#e5e7eb] text-sm font-semibold hover:text-blue-400 transition" id="nav-jadwal">Jadwal Rilis</a>
                <a href="list-anime.html" class="nav-link text-[#e5e7eb] text-sm font-semibold hover:text-blue-400 transition" id="nav-list">List Anime</a>
                <a href="genre.html" class="nav-link text-[#e5e7eb] text-sm font-semibold hover:text-blue-400 transition" id="nav-genre">List Genre</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 pb-20">
        
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8 border-b border-[#30363d] pb-4">
            <h1 class="text-2xl font-bold text-white flex items-center gap-2">üè∑Ô∏è Kategori Genre</h1>
            <input type="text" id="genreFilter" placeholder="Cari genre..." class="bg-[#161b22] border border-[#30363d] text-white text-sm rounded-lg px-4 py-2 w-full md:w-48 focus:border-blue-500 outline-none transition">
        </div>

        <div id="loading" class="text-center py-20">
            <div class="inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
            <p class="text-gray-500 text-sm">Mengambil daftar genre...</p>
        </div>

        <div id="error-msg" class="hidden text-center py-10 text-red-400 bg-red-900/10 rounded-lg">Gagal mengambil data dari STB.</div>

        <div id="genre-container" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3 hidden">
            </div>

    </main>

    <script>
        // Fallback Config
        if (typeof API_BASE_URL === 'undefined') { var API_BASE_URL = "https://reduced-confidence-muscle-baseline.trycloudflare.com/otakudesu/genre"; }

        document.addEventListener("DOMContentLoaded", function() {
            // Set Navigasi Aktif
            const navItem = document.getElementById('nav-genre');
            if(navItem) {
                navItem.classList.add('text-blue-500', 'border-b-2', 'border-blue-500');
                navItem.classList.remove('text-[#e5e7eb]');
            }

            // Ambil Data
            fetchGenres();
        });

        async function fetchGenres() {
            const loading = document.getElementById('loading');
            const errorMsg = document.getElementById('error-msg');
            const container = document.getElementById('genre-container');

            try {
                // Fetch ke API STB
                const req = await fetch(`${API_BASE_URL}/otakudesu/genre`);
                if(!req.ok) throw new Error("Gagal fetch API");
                
                const res = await req.json();
                
                // Ambil array dari res.data.genreList
                const list = res.data?.genreList || [];

                if(list.length === 0) {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-500">Tidak ada genre ditemukan.</p>';
                } else {
                    renderGenres(list);
                }

                loading.classList.add('hidden');
                container.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                loading.classList.add('hidden');
                errorMsg.classList.remove('hidden');
            }
        }

        function renderGenres(list) {
            const container = document.getElementById('genre-container');
            let html = '';
            
            // List warna border untuk variasi visual (Opsional)
            const colors = ['border-red-500', 'border-blue-500', 'border-green-500', 'border-yellow-500', 'border-purple-500', 'border-pink-500', 'border-indigo-500'];

            list.forEach((item, index) => {
                // Pilih warna acak berdasarkan index
                const colorClass = colors[index % colors.length];
                
                // Buat link ke halaman hasil genre (misal: search.html?genre=action)
                // Kita gunakan ID genre dari JSON: item.genreId
                const link = `genre-result.html?id=${item.genreId}`;

                html += `
                <a href="${link}" class="genre-item genre-card block bg-[#161b22] rounded-lg p-4 border-l-4 ${colorClass} hover:bg-[#21262d] group">
                    <h3 class="text-sm font-bold text-gray-200 group-hover:text-white truncate">${item.title}</h3>
                    <p class="text-[10px] text-gray-500 mt-1 uppercase tracking-wider">Genre</p>
                </a>`;
            });

            container.innerHTML = html;
        }

        // --- FILTER CLIENT SIDE ---
        document.getElementById('genreFilter').addEventListener('input', function(e) {
            const keyword = e.target.value.toLowerCase();
            const items = document.querySelectorAll('.genre-item');

            items.forEach(item => {
                const title = item.querySelector('h3').innerText.toLowerCase();
                if(title.includes(keyword)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    </script>
</body>

</html>

