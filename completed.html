<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Completed - NekoStream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>

    <style>
        body { background-color: #0d1117; color: #e0e0e0; font-family: sans-serif; }
        .card-font { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .text-shadow { text-shadow: 1px 1px 2px rgba(0,0,0,0.8); }
        
        /* Style Navigasi */
        .nav-link { color: #e5e7eb; font-size: 0.875rem; font-weight: 600; transition: color 0.2s; }
        .nav-link:hover { color: #60a5fa; } 
        .nav-link.active { color: #3b82f6; font-weight: bold; }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col pb-20">

    <header class="bg-[#161b22] border-b border-[#30363d] sticky top-0 z-50 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <nav class="flex flex-wrap justify-center gap-6">
                <a href="index.html" class="nav-link" id="nav-home">Home</a>
                <a href="ongoing.html" class="nav-link" id="nav-ongoing">On Going</a>
                <a href="jadwal.html" class="nav-link" id="nav-jadwal">Jadwal Rilis</a>
                <a href="list-anime.html" class="nav-link" id="nav-list">List Anime</a>
                <a href="genre.html" class="nav-link" id="nav-genre">List Genre</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-2 md:p-4 max-w-5xl">
        <div class="flex items-center justify-between mb-6 border-b border-[#30363d] pb-4">
            <h1 class="text-xl font-bold text-white uppercase tracking-wide">✅ Anime Tamat (Completed)</h1>
        </div>
        <div id="loading" class="text-center py-20">
            <div class="inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
            <p class="text-gray-500 text-xs">Memuat data...</p>
        </div>

        <div id="anime-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 hidden"></div>

        <div id="pagination" class="hidden flex justify-center items-center gap-4 mt-8 pt-6 border-t border-[#30363d]">
            <button id="btn-prev" class="px-4 py-2 bg-[#21262d] border border-[#30363d] rounded text-xs font-bold text-gray-400 hover:text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition uppercase">
                ← Prev
            </button>
            
            <span class="text-xs font-bold text-white">
                Page <span id="current-page-num">1</span> / <span id="total-page-num">?</span>
            </span>
            
            <button id="btn-next" class="px-4 py-2 bg-[#21262d] border border-[#30363d] rounded text-xs font-bold text-gray-400 hover:text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition uppercase">
                Next →
            </button>
        </div>

    </main>

    <script>
        if (typeof API_BASE_URL === 'undefined') { var API_BASE_URL = "https://reduced-confidence-muscle-baseline.trycloudflare.com/otakudesu/completed"; }
        
        let currentPage = 1;

        document.addEventListener("DOMContentLoaded", () => {
            // Load Halaman Pertama
            fetchCompleted(1);
            
            // Event Listener Tombol
            document.getElementById('btn-prev').addEventListener('click', () => {
                if(currentPage > 1) fetchCompleted(currentPage - 1);
            });
            document.getElementById('btn-next').addEventListener('click', () => {
                fetchCompleted(currentPage + 1);
            });
        });

        async function fetchCompleted(page) {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('anime-grid');
            const paginationDiv = document.getElementById('pagination');

            // Reset UI saat loading
            loading.classList.remove('hidden');
            grid.classList.add('hidden');
            paginationDiv.classList.add('hidden');
            window.scrollTo(0,0);

            try {
                // Fetch API ke Server
                const req = await fetch(`${API_BASE_URL}/otakudesu/completed?page=${page}`);
                if(!req.ok) throw new Error("Gagal fetch");
                
                const res = await req.json();
                
                // Ambil Data Sesuai JSON
                const animeList = res.data?.animeList || [];
                const meta = res.data?.pagination || {};

                if(animeList.length === 0) {
                    grid.innerHTML = '<p class="col-span-full text-center text-gray-500 text-xs">Tidak ada data.</p>';
                    grid.classList.remove('hidden');
                    loading.classList.add('hidden');
                    return;
                }

                renderCards(animeList);
                updatePagination(meta, page);

                loading.classList.add('hidden');
                grid.classList.remove('hidden');
                paginationDiv.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                grid.innerHTML = `<p class="col-span-full text-center text-red-500 text-xs">Error: ${err.message}</p>`;
                loading.classList.add('hidden');
                grid.classList.remove('hidden');
            }
        }

        function renderCards(list) {
            const grid = document.getElementById('anime-grid');
            let html = '';

            list.forEach(anime => {
                const score = anime.score || 'N/A';
                
                html += `
                <a href="detail.html?id=${anime.animeId}" class="relative aspect-[3/4] overflow-hidden bg-gray-800 group shadow-lg">
                    <img src="${anime.poster}" alt="${anime.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>

                    <div class="absolute top-0 left-0 bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-1 flex items-center gap-1 border-r border-b border-white/10">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                        ${anime.episodes} Eps
                    </div>

                    <div class="absolute top-7 left-2 text-white text-[10px] font-medium text-shadow opacity-90">
                        ${anime.lastReleaseDate}
                    </div>

                    <div class="absolute bottom-10 right-0">
                        <span class="bg-blue-700 text-white text-[10px] font-bold px-2 py-1 rounded-l-sm shadow-md flex items-center gap-1">
                            ★ ${score}
                        </span>
                    </div>

                    <div class="absolute bottom-0 w-full bg-black/70 backdrop-blur-[2px] p-2 border-t border-white/5">
                        <h3 class="text-white text-[11px] font-medium leading-tight line-clamp-1 text-center card-font">
                            ${anime.title}
                        </h3>
                    </div>
                </a>`;
            });
            grid.innerHTML = html;
        }

                function updatePagination(meta, page) {
            currentPage = page;
            
            // Ambil elemen teks di tengah tombol
            // Pastikan di HTML ada: <span class="text-xs font-bold text-white">Page <span id="current-page-num">1</span> <span id="total-page-container"></span></span>
            // Atau kita mainkan innerHTML parent-nya saja biar gampang:
            
            const paginationContainer = document.querySelector('#pagination span'); 
            
            if (meta.totalPages) {
                // KARENA DATA TOTAL PAGES ADA (65), KITA TAMPILKAN!
                paginationContainer.innerHTML = `Page <span id="current-page-num">${currentPage}</span> / <span id="total-page-num">${meta.totalPages}</span>`;
            } else {
                // Jaga-jaga kalau suatu saat datanya hilang
                paginationContainer.innerHTML = `Page <span id="current-page-num">${currentPage}</span>`;
            }

            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');

            // Logika Tombol (Server kamu kirim hasNextPage: true, jadi ini aman)
            if (meta.hasPrevPage !== undefined) {
                btnPrev.disabled = !meta.hasPrevPage;
                btnNext.disabled = !meta.hasNextPage;
            } else {
                btnPrev.disabled = (currentPage === 1);
                btnNext.disabled = false;
            }
        }
    </script>
</body>

</html>





