<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Rilis Full - NekoStream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
    <style>
        body { background-color: #0d1117; color: #e0e0e0; font-family: sans-serif; }
        .card-font { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .nav-link { color: #e5e7eb; font-size: 0.875rem; font-weight: 600; transition: color 0.2s; }
        .nav-link:hover { color: #60a5fa; } 
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col pb-20">

    <header class="bg-[#161b22] border-b border-[#30363d] sticky top-0 z-50 p-4 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <nav class="flex flex-wrap justify-center gap-6">
                <a href="index.html" class="nav-link">Home</a>
                <a href="ongoing.html" class="nav-link">On Going</a>
                <a href="jadwal.html" class="nav-link text-blue-500 font-bold border-b-2 border-blue-500">Jadwal Rilis</a>
                <a href="list-anime.html" class="nav-link">List Anime</a>
                <a href="genre.html" class="nav-link">List Genre</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-2 md:p-4 max-w-5xl">
        <div class="flex items-center justify-between mb-6 border-b border-[#30363d] pb-4">
            <h1 class="text-xl font-bold text-white uppercase tracking-wide">ðŸ“… SEMUA JADWAL TAYANG</h1>
            <span class="text-xs text-gray-400 bg-[#161b22] px-3 py-1 rounded border border-[#30363d]" id="total-anime-count">...</span>
        </div>

        <div id="loading" class="text-center py-20">
            <div class="inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
            <p class="text-gray-500 text-xs">Memuat jadwal...</p>
        </div>

        <div id="anime-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 hidden"></div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            fetchFullJadwal();
        });

        async function fetchFullJadwal() {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('anime-grid');
            const countLabel = document.getElementById('total-anime-count');
            
            // Fallback config
            const baseURL = (typeof API_BASE_URL !== 'undefined') ? API_BASE_URL : "http://localhost:3000";

            try {
                const req = await fetch(`${baseURL}/otakudesu/schedule`);
                if(!req.ok) throw new Error("Gagal fetch data");
                
                const res = await req.json();
                
                // --- BAGIAN PERBAIKAN UTAMA ---
                // Sesuai screenshot: datanya ada di res.data.scheduleList
                const daysData = res.data?.scheduleList || [];
                
                let allAnime = [];
                
                daysData.forEach(dayItem => {
                    // Sesuai screenshot: Nama hari pakai 'title', bukan 'day'
                    const dayName = dayItem.title || "Unknown"; 
                    const list = dayItem.animeList || [];
                    
                    list.forEach(anime => {
                        anime.releaseDay = dayName; // Tempel nama hari
                        allAnime.push(anime);
                    });
                });

                countLabel.innerText = `${allAnime.length} Anime`;

                if(allAnime.length === 0) {
                    grid.innerHTML = '<p class="col-span-full text-center text-gray-500 text-xs">Jadwal kosong.</p>';
                } else {
                    renderCards(allAnime);
                }

                loading.classList.add('hidden');
                grid.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                grid.innerHTML = `<div class="col-span-full text-center text-red-500 text-xs py-10">Error: ${err.message}</div>`;
                loading.classList.add('hidden');
                grid.classList.remove('hidden');
            }
        }

        function renderCards(list) {
            const grid = document.getElementById('anime-grid');
            let html = '';

            list.forEach(anime => {
                const id = anime.animeId || anime.id;
                // Kadang url poster dari API Otakudesu suka http biasa, kita paksa https kalau perlu
                const poster = anime.poster || 'https://via.placeholder.com/150'; 
                const day = anime.releaseDay;

                // Warna badge beda-beda biar cantik
                let badgeColor = 'bg-blue-600';
                if(day === 'Minggu') badgeColor = 'bg-red-600';
                if(day === 'Jumat') badgeColor = 'bg-green-600';

                html += `
                <a href="detail.html?id=${id}" class="relative aspect-[3/4] overflow-hidden bg-gray-800 group shadow-lg rounded-md border border-[#30363d] hover:border-blue-500 transition-colors">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
                    
                    <div class="absolute top-0 left-0 ${badgeColor} text-white text-[10px] font-bold px-2 py-1 rounded-br-sm shadow-md uppercase z-10">
                        ${day}
                    </div>

                    <div class="absolute bottom-0 w-full bg-black/70 backdrop-blur-[2px] p-2 border-t border-white/5">
                        <h3 class="text-white text-[11px] font-medium leading-tight line-clamp-2 text-center card-font group-hover:text-blue-400 transition-colors">
                            ${anime.title}
                        </h3>
                    </div>
                </a>`;
            });
            grid.innerHTML = html;
        }
    </script>
</body>
</html>

